/*!
 * Html-Parser v1.0.0
 * (c) 2018 Nathan Anderson
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Thenja=e():t.Thenja=e()}(this,function(){return function(t){function e(s){if(r[s])return r[s].exports;var a=r[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,s){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ELEMENT_TYPES={TAG:"tag",TEXT:"text",COMMENT:"comment"},e.EMPTY_TAGS={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1},e.MODE_TYPES={TEXT:"text",TAG:"tag",STYLE:"style",SCRIPT:"script"},e.TAG_TYPES={EMPTY:"empty",DEFAULT:"default",SCRIPT:"script",STYLE:"style",COMMENT:"comment"}},function(t,e,r){"use strict";function s(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}Object.defineProperty(e,"__esModule",{value:!0}),s(r(0)),s(r(2))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r(3),a=r(0),n=r(4),i=function(){function t(){this.errorCb=null}return t.prototype.reset=function(){this.state={mode:a.MODE_TYPES.TEXT,html:"",currentPos:0,output:[]}},t.prototype.addNodeElement=function(t,e){e?(e.children||(e.children=[]),e.children.push(t)):this.state.output.push(t)},t.prototype.createTextNode=function(t){return{type:a.ELEMENT_TYPES.TEXT,data:t}},t.prototype.createCommentNode=function(t){return{type:a.ELEMENT_TYPES.COMMENT,data:t}},t.prototype.createTagNode=function(t){var e=t.indexOf(" "),r=t.indexOf(">"),n=e>-1&&e<r?e:r,i=t.substring(1,n);return i=s.utility.removeWhitespace(i),{type:a.ELEMENT_TYPES.TAG,tagType:this.getTagType(i),name:i,attributes:this.parseAttributes(t),children:[]}},t.prototype.getTagType=function(t){return t=t.toLowerCase(),a.EMPTY_TAGS[t]?a.TAG_TYPES.EMPTY:t===a.TAG_TYPES.STYLE?a.TAG_TYPES.STYLE:t===a.TAG_TYPES.SCRIPT?a.TAG_TYPES.SCRIPT:t===a.TAG_TYPES.COMMENT?a.TAG_TYPES.COMMENT:a.TAG_TYPES.DEFAULT},t.prototype.getNextTag=function(t){for(var e=0;e<t.length;){if(s.utility.isStartOfTag(t[e],t[e+1]))return{type:"start",pos:e};if(s.utility.isEndOfTag(t[e],t[e+1]))return{type:"end",pos:e};if(s.utility.isStartOfComment(t.substr(e)))return{type:"comment",pos:e};e++}return{type:"no-tag"}},t.prototype.parseText=function(t){var e=this.state.html.substring(this.state.currentPos),r=this.getNextTag(e);if("start"===r.type)this.handleStartTagInText(r,e,t);else if("end"===r.type)this.handleEndTagInText(r,e,t);else if("comment"===r.type)this.handleCommentInText(r,e,t);else if(e.length>0){var s=this.createTextNode(e);this.addNodeElement(s,t)}},t.prototype.handleStartTagInText=function(t,e,r){if(t.pos>0){var s=e.substring(0,t.pos),n=this.createTextNode(s);this.addNodeElement(n,r)}this.state.mode=a.MODE_TYPES.TAG,this.state.currentPos=this.state.currentPos+t.pos,this._parse(r)},t.prototype.handleEndTagInText=function(t,e,r){if(t.pos>0){var s=e.substring(0,t.pos),n=this.createTextNode(s);this.addNodeElement(n,r)}var i=e.indexOf(">",t.pos)+1,o=e.substring(t.pos,i),u=o.replace("</","").replace(">","");if(!r){var p=new Error("No start tag for end tag: "+u);this.errorCb&&this.errorCb(p)}if(r.name.toLowerCase()!==u.toLowerCase()){var p=Error("Start tag ("+r.name+") and end tag ("+u+") do not match");this.errorCb&&this.errorCb(p)}this.state.mode=a.MODE_TYPES.TEXT,this.state.currentPos=this.state.currentPos+i;var h=r.parentElement;delete r.parentElement,this._parse(h)},t.prototype.handleCommentInText=function(t,e,r){if(t.pos>0){var s=e.substring(0,t.pos),n=this.createTextNode(s);this.addNodeElement(n,r)}var i=e.indexOf("--\x3e");if(!i){var o=new Error("Comment does not have an end tag");this.errorCb&&this.errorCb(o)}var u=e.substring(t.pos+4,i),p=this.createCommentNode(u);this.addNodeElement(p,r),this.state.mode=a.MODE_TYPES.TEXT,this.state.currentPos=this.state.currentPos+(i+3),this._parse(r)},t.prototype.parseTag=function(t){var e=this.state.html.substring(this.state.currentPos),r=e.indexOf(">")+1,s=e.substring(0,r),n=this.createTagNode(s);this.state.currentPos=this.state.currentPos+r,this.addNodeElement(n,t),this.state.mode=a.MODE_TYPES.TEXT,n.tagType===a.TAG_TYPES.EMPTY?this._parse(t):n.tagType===a.TAG_TYPES.STYLE?(this.state.mode=a.MODE_TYPES.STYLE,n.parentElement=t,this._parse(n)):n.tagType===a.TAG_TYPES.SCRIPT?(this.state.mode=a.MODE_TYPES.SCRIPT,n.parentElement=t,this._parse(n)):(n.parentElement=t,this._parse(n))},t.prototype.parseAttributes=function(t){return(new n.AttributeParser).parse(t)},t.prototype.parseScript=function(t,e){var r=this.state.html.substring(this.state.currentPos),s=r.indexOf(e);if(s<0){var n=new Error("Script ("+t.name+" ) does not have an end tag");this.errorCb&&this.errorCb(n)}var i=r.substring(0,s),o=this.createTextNode(i);this.addNodeElement(o,t),this.state.currentPos=this.state.currentPos+(s+e.length),this.state.mode=a.MODE_TYPES.TEXT;var u=t.parentElement;delete t.parentElement,this._parse(u)},t.prototype._parse=function(t){switch(this.state.mode){case a.MODE_TYPES.TEXT:this.parseText(t);break;case a.MODE_TYPES.TAG:this.parseTag(t);break;case a.MODE_TYPES.STYLE:this.parseScript(t,"</style>");break;case a.MODE_TYPES.SCRIPT:this.parseScript(t,"<\/script>")}},t.prototype.parse=function(t,e){return e&&(this.errorCb=e),this.reset(),this.state.html=t,this._parse(null),this.state.output},t.prototype.reverse=function(t){return this.reverseNodes(0,t,"")},t.prototype.reverseNodes=function(t,e,r){if(t>=e.length)return r;var s=e[t];if(s.type===a.ELEMENT_TYPES.TEXT)r+=s.data;else if(s.type===a.ELEMENT_TYPES.COMMENT)r+="\x3c!--"+s.data+"--\x3e";else{var i=new n.AttributeParser,o=i.reverse(s.attributes);if(o=o.length>0?" "+o:o,s.tagType===a.TAG_TYPES.EMPTY)r+="<"+s.name+o+" />";else{if(r+="<"+s.name+o+">",s.children&&s.children.length>0){var u=this.reverseNodes(0,s.children,"");r+=u}r+="</"+s.name+">"}}return t++,this.reverseNodes(t,e,r)},t}();e.HtmlParser=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.prototype.removeWhitespace=function(t){return t=t.trim(),t=t.split(" ").join(""),t=t.split("\t").join(""),t=t.split(" ").join(""),t=t.split("\n").join(""),t=t.split("\r").join(""),t=t.split("\n").join("")},t.prototype.isLetter=function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"},t.prototype.isStartOfTag=function(t,e){return!(!t||!e)&&("<"===t&&this.isLetter(e))},t.prototype.isEndOfTag=function(t,e){return!(!t||!e)&&("<"===t&&"/"===e)},t.prototype.isStartOfComment=function(t){return 0===t.indexOf("\x3c!--")},t}();e.Utility=s;var a=new s;e.utility=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={READING_ATTR_NAME:"reading-attr-name",READING_ATTR_VALUE:"reading-attr-value"},a=function(){function t(){this.state={text:"",currentPos:0,mode:s.READING_ATTR_NAME,attrName:"",attrValue:""}}return t.prototype.isWhitespace=function(t){return"\t"===t||" "===t||" "===t||"\n"===t||"\r"===t||"\n"===t},t.prototype.reset=function(){this.state={text:"",currentPos:0,mode:"reading-attr-name",attrName:"",attrValue:""}},t.prototype.getNextChar=function(){var t=null;return this.state.currentPos<this.state.text.length&&(t=this.state.text.charAt(this.state.currentPos),this.state.currentPos++),t},t.prototype._parse=function(t){var e={};for(this.state.text=t;;){var r=this.getNextChar();if(null===r){this.state.attrName&&(e[this.state.attrName]=this.state.attrValue?this.state.attrValue:null);break}this.state.mode===s.READING_ATTR_NAME?this.handleReadingAttrName(r,e):this.state.mode===s.READING_ATTR_VALUE&&this.handleReadingAttrValue(r,e)}return e},t.prototype.handleReadingAttrName=function(t,e){"="===t?this.state.mode=s.READING_ATTR_VALUE:"/"===t||(this.isWhitespace(t)?this.state.attrName&&(e[this.state.attrName]=null,this.state.attrName=""):this.state.attrName=this.state.attrName+t)},t.prototype.handleReadingAttrValue=function(t,e){if(this.isWhitespace(t)){var r=this.state.attrValue[0],a=this.state.attrValue[this.state.attrValue.length-1];"'"!==r&&'"'!==r||r===a?(e[this.state.attrName]=this.state.attrValue,this.state.mode=s.READING_ATTR_NAME,this.state.attrName="",this.state.attrValue=""):this.state.attrValue=this.state.attrValue+t}else this.state.attrValue=this.state.attrValue+t},t.prototype.parse=function(t){this.reset();var e={},r=t.indexOf(" "),s=t.indexOf(">");if(r>-1&&r<s){var a=t.substring(r,s);a=a.trim(),e=this._parse(a)}return e},t.prototype.reverse=function(t){var e="";for(var r in t)null===t[r]?e+=" "+r:e+=" "+r+"="+t[r];return e.trim()},t}();e.AttributeParser=a}])});